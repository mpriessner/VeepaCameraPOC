platform :ios, '17.0'

# Flutter framework location based on build configuration
flutter_framework_dir = File.join(File.dirname(__FILE__), 'Flutter')

target 'VeepaPOC' do
  use_frameworks!

  # Flutter frameworks - use Debug for development
  pod 'Flutter', :podspec => "#{flutter_framework_dir}/Debug/Flutter.podspec" if File.exist?("#{flutter_framework_dir}/Debug/Flutter.podspec")

  # Or embed directly if podspec doesn't exist
  if !File.exist?("#{flutter_framework_dir}/Debug/Flutter.podspec")
    # Embed Flutter frameworks directly
    config_dir = ENV['FLUTTER_BUILD_MODE'] || 'Debug'
    framework_dir = "#{flutter_framework_dir}/#{config_dir}"

    Dir["#{framework_dir}/*.xcframework"].each do |framework|
      framework_name = File.basename(framework, '.xcframework')
      pod framework_name, :podspec => "#{framework_dir}/#{framework_name}.podspec" if File.exist?("#{framework_dir}/#{framework_name}.podspec")
    end
  end
end

post_install do |installer|
  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '17.0'
      config.build_settings['BUILD_LIBRARY_FOR_DISTRIBUTION'] = 'YES'
    end
  end
end
